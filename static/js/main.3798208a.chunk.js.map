{"version":3,"sources":["TriggerIcon.js","ExportFooter.js","fields.js","UserHint.js","CardDock.js","IntroPanel.js","Legend.js","LoadingMask.js","Tooltip.js","App.js","index.js"],"names":["ICON_TYPE","TriggerIcon","this","props","onClick","x1","x2","y1","y2","stemless","d","strokeLinecap","strokeLinejoin","fill","cx","cy","r","x","y","width","height","rx","icon","points","classes","viewBox","iconType","getRemove","getExpand","getCollapse","getRightArrow","getInfoIcon","getLegend","getXClose","console","error","inBrackets","getBracketWrap","className","title","React","Component","ExportFooter","log","print","exportCSV","type","value","readOnly","copy","SHEET_FIELDS","LONGITUDE","displayName","sheetId","LATITUDE","EID","NAME","TYPE","LOCATION","DATES","RECIPIENTS","IMPLEMENTER","RESEARCHER","FUNDER","TARGETING","UNIT","AMOUNT","FREQUENCY","EVALUATION","NOTES","WEBSITE","forceUniformValue","LINKURL1","LINKTITLE1","LINKURL2","LINKTITLE2","LINKURL3","LINKTITLE3","LINKURL4","LINKTITLE4","LINKURL5","LINKTITLE5","LINKURL6","LINKTITLE6","LINK_FIELD_PAIRS","urlField","titleField","FEATURE_HEADERS","ORGANIZATIONAL","isFeatureHeader","IMPLEMENTATION","COMPOSITE_FIELDS","RELATED_RESOURCES","isComposite","ORDERED_CARD_FIELDS","ORDERED_CSV_FIELDS","UserHint","dismissed","dismissTrigger","onDismiss","content","CardDock","state","scrollHintDismissed","maxPointHintDismissed","mapMaskActive","sideButtonsActive","removeCard","bind","updateMask","dismissMaxPointHint","scrollUp","scrollDown","throttledUpdateMask","_","throttle","leading","trailing","newProps","cardData","length","maxCardHintTriggered","setState","setTimeout","id","e","deltaY","scrollTop","appRef","current","isTouchScreen","map","experimentCardSet","idx","eid","name","key","field","cellClass","cells","getCellContent","locationOneData","otherLocationsData","firstValue","some","l","getLocationCellContent","getLinksContent","includes","href","target","rel","getIsDifferentiated","locationData","location","cellContent","linkMap","orderedLinks","forEach","urlValue","titleValue","push","selectionHintDismissed","scroll","top","behavior","valueArrays","each","f","v","replace","csv","row","join","hiddenElement","document","createElement","encodeURIComponent","download","click","remove","maskClass","onWheel","onTouchMove","getScrollHint","getSelectionHint","getMaxPointHint","getNames","getRows","getSideButtons","PureComponent","SECTIONS","text","text2","text3","text4","IntroPanel","startOpen","window","innerWidth","open","activeSectionIdx","toggleOpen","setActiveSection","advanceActiveSection","prevActiveSection","sections","s","i","prevHandler","prevClasses","prevButton","nextHandler","nextClasses","nextButton","getHeader","getNav","getSection","getNextPrev","Legend","startExpanded","expanded","toggleExpand","LoadingMask","dataLoaded","mapLoaded","mapConfigured","Tooltip","left","adjusted","ref","createRef","nextProps","expId","adjustPosition","getBoundingClientRect","tooltipWidth","tooltipHeight","getElementById","windowWidth","windowHeight","POINT_BUFFER","otherLocations","hoveredClass","otherLocationElements","style","visibility","getLocations","mapboxgl","accessToken","process","App","hovered","selectedIds","mapContainer","getCardDock","getTooltip","getFeaturesByExperimentId","resetUSView","resetWorldView","Map","container","styleData","center","zoom","maxBounds","addControl","NavigationControl","dragRotate","disable","touchZoomRotate","disableRotation","on","markMapLoaded","debounce","featuresOnUnhover","getCenter","lat","toFixed","lng","getZoom","featuresOnClick","featuresOnHover","registerTouchScreen","load","call","setPaintProperty","getSource","_data","features","filter","properties","indexOf","alreadySelected","splice","updatePageURL","setFeatureState","source","selected","getCanvas","cursor","point","hover","flyTo","essential","fitBounds","aria-label","aria-hidden","queryString","numId","numericToStringEidMap","parent","postMessage","appOrigin","getResetViewButton","nextEidNumber","stringToNumericEidMap","String","prototype","startsWith","Object","defineProperty","search","rawPos","pos","substring","experimentsData","experimentsReq","XMLHttpRequest","addEventListener","req","JSON","parse","responseText","feed","entry","rows","keys","p","endsWith","substr","items","ri","$t","stringEid","numericEid","toLowerCase","geometry","coordinates","setData","startingIdx","endingIndex","idString","slice","split","compact","uniq","reqHandler","send","ReactDOM","render"],"mappings":"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","file":"static/js/main.3798208a.chunk.js","sourcesContent":["import React from 'react';\n\nconst ICON_TYPE = {\n  REMOVE: 'remove',\n  EXPAND: 'expand',\n  COLLAPSE: 'collapse',\n  D_ARROW: 'down-arrow',\n  D_ARROW_STEMLESS: 'down-arrow-stemless',\n  U_ARROW: 'up-arrow',\n  U_ARROW_STEMLESS: 'up-arrow-stemless',\n  R_ARROW: 'right-arrow',\n  R_ARROW_STEMLESS: 'right-arrow-stemless',\n  L_ARROW: 'left-arrow',\n  L_ARROW_STEMLESS: 'left-arrow-stemless',\n  INFO_ICON: 'info-icon',\n  LEGEND: 'legend',\n  XCLOSE: 'x-close'\n};\n\nclass TriggerIcon extends React.Component {\n  onClick() {\n    this.props.onClick();\n  }\n\n  getRemove() {\n    return (\n      <>\n        <line x1='15' x2='85' y1='15' y2='85'/>\n        <line x1='15' x2='85' y1='85' y2='15'/>\n      </>\n    )    \n  }\n  \n  getExpand() {\n    return (\n      <>\n        <line x1='15' x2='85' y1='50' y2='50'/>\n        <line x1='50' x2='50' y1='15' y2='85'/>\n      </>\n    )    \n  }\n\n  getCollapse() {\n    return (\n      <>\n        <line x1='20' x2='80' y1='50' y2='50'/>\n      </>\n    )    \n  }\n\n  // right arrow is our \"base\" arrow. all arrows are right arrows, then get rotated by CSS transform\n  getRightArrow(stemless) {\n    return (\n      <>\n        {!stemless && <path d=\"M1 5.5H10\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>}\n        <path fill=\"none\" d=\"M5.5 1L10 5.5L5.5 10\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n      </>\n    )\n  }\n\n  getXClose() {\n    return (\n      <>\n        <line x1=\"5.30326\" y1=\"5.30318\" x2=\"15.9099\" y2=\"15.9098\"/>\n        <line x1=\"15.9097\" y1=\"5.30326\" x2=\"5.30311\" y2=\"15.9099\"/>\n      </>  \n    )\n  }\n\n  getInfoIcon() {\n    return (\n      <>\n        <circle cx=\"13.5\" cy=\"13.5\" r=\"13.5\" fill=\"#DBEDF2\"/>\n        <circle cx=\"13.5\" cy=\"7.5\" r=\"1.5\" fill=\"#709FAC\"/>\n        <rect x=\"12\" y=\"11\" width=\"3\" height=\"10\" rx=\"1.5\" fill=\"#709FAC\"/>\n      </>\n    )\n  }\n\n  getLegend() {\n    return (\n      <>\n        <path d=\"M1 1L4.33334 2.01389V9.11111L1 8.09722V1Z\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        <path d=\"M7.66602 1L10.9994 2.01389V9.11111L7.66602 8.09722V1Z\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n        <path d=\"M4.33398 2.01389L7.66733 1V8.09722L4.33398 9.11111V2.01389Z\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n      </>\n    )\n  }\n  \n  getBracketWrap(icon) {\n    return (\n      <>\n        <polyline points='15,0 0,0 0,100 15,100' />\n          {icon}\n        <polyline points='85,0 100,0 100,100 85,100' />\n      </>\n    )    \n  }\n  \n  render() {\n    let icon;\n    let classes = 'trigger-icon ';\n    let viewBox = '0 0 100 100';\n    switch (this.props.iconType) {\n      case ICON_TYPE.REMOVE:\n        icon = this.getRemove();\n        classes += 'remove-icon';\n        break;\n      case ICON_TYPE.EXPAND:\n        icon = this.getExpand();\n        classes += 'expand-icon';\n        break;\n      case ICON_TYPE.COLLAPSE:\n        icon = this.getCollapse();\n        classes += 'collapse-icon';\n        break;\n      case ICON_TYPE.D_ARROW:\n        icon = this.getRightArrow();\n        classes += 'down arrow';\n        viewBox = '0 0 11 11';\n        break;\n      case ICON_TYPE.D_ARROW_STEMLESS:\n        icon = this.getRightArrow(true);\n        classes += 'down arrow stemless';\n        viewBox = '0 0 11 11';\n        break;\n      case ICON_TYPE.U_ARROW:\n        icon = this.getRightArrow();\n        classes += 'up arrow';\n        viewBox = '0 0 11 11';\n        break;\n      case ICON_TYPE.U_ARROW_STEMLESS:\n        icon = this.getRightArrow(true);\n        classes += 'up arrow stemless';\n        viewBox = '0 0 11 11';\n        break;\n      case ICON_TYPE.R_ARROW:\n        icon = this.getRightArrow();\n        classes += 'right arrow';\n        viewBox = '0 0 11 11';\n        break;\n      case ICON_TYPE.R_ARROW_STEMLESS:\n        icon = this.getRightArrow(true);\n        classes += 'right arrow stemless';\n        viewBox = '0 0 11 11'\n        break;\n      case ICON_TYPE.L_ARROW:\n        icon = this.getRightArrow();\n        classes += 'left arrow';\n        viewBox = '0 0 11 11';\n        break;\n      case ICON_TYPE.L_ARROW_STEMLESS:\n        icon = this.getRightArrow(true);\n        classes += 'left arrow stemless';\n        viewBox = '0 0 11 11'\n        break;\n      case ICON_TYPE.INFO_ICON:\n        icon = this.getInfoIcon();\n        classes += 'info-icon';\n        viewBox = '0 0 27 27'\n        break;\n      case ICON_TYPE.LEGEND:\n        icon = this.getLegend();\n        classes += 'legend';\n        viewBox = '-1 0 15 10';\n        break;\n      case ICON_TYPE.XCLOSE:\n        icon = this.getXClose(true);\n        classes += 'x-close remove-icon';\n        viewBox = \"0 0 22 22\"\n        break;  \n      default:\n        console.error('incorrect type: ', this.props.iconType);\n    }\n\n    if (this.props.inBrackets) {\n      classes += ' bracketed';\n      icon = this.getBracketWrap(icon);\n    }\n\n    return (\n        <svg\n          onClick={this.props.onClick}\n          viewBox={viewBox}\n          className={classes}\n        >\n          {this.props.title && <title>{this.props.title}</title>}\n          {icon}\n        </svg>\n    )\n  }\n}\n\nexport default TriggerIcon;\nexport { ICON_TYPE };\n","import React from 'react';\nimport TriggerIcon, { ICON_TYPE } from './TriggerIcon';\n\nclass ExportFooter extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  print() {\n    console.log('print');\n  }\n  \n  export() {\n    console.log('export');\n  }\n  \n  copy() {\n    console.log('share');\n  }\n\n  render() {\n    return (\n      <div className='export-footer'>\n        <div className='print section'>\n          <div className='title element'>Print</div>\n          <div className='icon element'></div>\n          <div className='description element'>\n            Print or save your experiments as a PDF\n          </div>\n          <div className='button element' onClick={this.print}>PRINT</div>\n        </div>\n\n        <div className='export section'>\n          <div className='title element'>Export</div>\n          <div className='icon element'></div>\n          <div className='description element'>\n            Export your selected experiments to CSV\n          </div>\n          <div className='button element' onClick={this.props.exportCSV}>EXPORT</div>\n        </div>\n\n        <div className='share section'>\n          <div className='title element'>Share</div>\n          <div className='icon element'></div>\n          <div className='description element'>\n            Share a link to your selected experiments\n          </div>\n          <div className='button-group element'>\n            <input type='text' value='www.linkvalue.com' readOnly />\n            <div className='button' onClick={this.copy}>COPY</div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default ExportFooter;\n","const SHEET_FIELDS = {\n  LONGITUDE: {\n    displayName: 'Longitude', // how the field will appear on the card\n    sheetId: 'longitude' // corresponds to the column header on the google sheet\n  },\n  LATITUDE: {\n    displayName: 'Latitude',\n    sheetId: 'latitude'\n  },\n  // NOTE: Used to bind the different locations of a given experiment together.\n  // We use it as the mapbox ID for the feature to simplify unified hover/selection styling.\n  EID: {\n    displayName: 'Experiment ID',\n    sheetId: 'eid'\n  },\n  NAME: {\n    displayName: 'Name of Experiment',\n    sheetId: 'name'\n  },\n  TYPE: {\n    displayName: 'Past, Ongoing, Proposed',\n    sheetId: 'type'\n  },\n  LOCATION: {\n    displayName: 'Location',\n    sheetId: 'location'\n  },\n  DATES: {\n    displayName: 'Implementation Dates',\n    sheetId: 'dates'\n  },\n  RECIPIENTS: {\n    displayName: 'Number of Recipients',\n    sheetId: 'recipients'\n  },\n  IMPLEMENTER: {\n    displayName: 'Implementing Agency',\n    sheetId: 'implementer',\n    // isExpandible: true\n  },\n  RESEARCHER: {\n    displayName: 'Research Agency',\n    sheetId: 'researcher',\n    // isExpandible: true\n  },\n  FUNDER: {\n    displayName: 'Funding Agency',\n    sheetId: 'funder',\n    // isExpandible: true\n  },\n  TARGETING: {\n    displayName: 'Type of Targeting',\n    sheetId: 'targeting',\n    // isExpandible: true\n  },\n  UNIT: {\n    displayName: 'Unit of Recipient',\n    sheetId: 'unit'\n  },\n  AMOUNT: {\n    displayName: 'Amount of Transfer',\n    sheetId: 'amount',\n    // isExpandible: true\n  },\n  FREQUENCY: {\n    displayName: 'Frequency of Payment',\n    sheetId: 'frequency'\n  },\n  EVALUATION: {\n    displayName: 'Method of Evaluation',\n    sheetId: 'evaluation'\n  },\n  NOTES: {\n    displayName: 'Additional Notes of Interest',\n    sheetId: 'notes',\n    // isExpandible: true\n  },\n  WEBSITE: {\n    displayName: 'Link to Website',\n    sheetId: 'website',\n    forceUniformValue: true\n  },\n  LINKURL1: {\n    displayName: 'Link to Related Resource 1',\n    sheetId: 'linkurl1'\n  },\n  LINKTITLE1: {\n    displayName: 'Link title 1',\n    sheetId: 'linktitle1'\n  },\n  LINKURL2: {\n    displayName: 'Link to Related Resource 2',\n    sheetId: 'linkurl2'\n  },\n  LINKTITLE2: {\n    displayName: 'Link title 2',\n    sheetId: 'linktitle2'\n  },\n  LINKURL3: {\n    displayName: 'Link to Related Resource 3',\n    sheetId: 'linkurl3'\n  },\n  LINKTITLE3: {\n    displayName: 'Link title 3',\n    sheetId: 'linktitle3'\n  },\n  LINKURL4: {\n    displayName: 'Link to Related Resource 4',\n    sheetId: 'linkurl4'\n  },\n  LINKTITLE4: {\n    displayName: 'Link title 4',\n    sheetId: 'linktitle4'\n  },\n  LINKURL5: {\n    displayName: 'Link to Related Resource 5',\n    sheetId: 'linkurl5'\n  },\n  LINKTITLE5: {\n    displayName: 'Link title 5',\n    sheetId: 'linktitle5'\n  },\n  LINKURL6: {\n    displayName: 'Link to Related Resource 6',\n    sheetId: 'linkurl6'\n  },\n  LINKTITLE6: {\n    displayName: 'Link title 6',\n    sheetId: 'linktitle6'\n  }\n};\n\nconst LINK_FIELD_PAIRS = [\n  { urlField: SHEET_FIELDS.LINKURL1, titleField: SHEET_FIELDS.LINKTITLE1 },\n  { urlField: SHEET_FIELDS.LINKURL2, titleField: SHEET_FIELDS.LINKTITLE2 },\n  { urlField: SHEET_FIELDS.LINKURL3, titleField: SHEET_FIELDS.LINKTITLE3 },\n  { urlField: SHEET_FIELDS.LINKURL4, titleField: SHEET_FIELDS.LINKTITLE4 },\n  { urlField: SHEET_FIELDS.LINKURL5, titleField: SHEET_FIELDS.LINKTITLE5 },\n  { urlField: SHEET_FIELDS.LINKURL6, titleField: SHEET_FIELDS.LINKTITLE6 },\n];\n\nconst FEATURE_HEADERS = {\n  ORGANIZATIONAL: {\n    displayName: 'ORGANIZATIONAL FEATURES',\n    sheetId: null,\n    isFeatureHeader: true\n  },\n  IMPLEMENTATION: {\n    displayName: 'IMPLEMENTATION FEATURES',\n    sheetId: null,\n    isFeatureHeader: true\n  },\n};\n\nconst COMPOSITE_FIELDS = {\n  RELATED_RESOURCES: {\n    displayName: 'Links to Related Resources',\n    sheetId: null,\n    // isExpandible: true,\n    isComposite: true\n  }\n};\n\nconst ORDERED_CARD_FIELDS = [\n  // SHEET_FIELDS.LONGITUDE,\n  // SHEET_FIELDS.LATITUDE,\n  // SHEET_FIELDS.EID,\n  // SHEET_FIELDS.NAME,\n  // SHEET_FIELDS.TYPE,\n  SHEET_FIELDS.LOCATION,\n  SHEET_FIELDS.DATES,\n  SHEET_FIELDS.RECIPIENTS,\n  FEATURE_HEADERS.ORGANIZATIONAL,\n  SHEET_FIELDS.IMPLEMENTER,\n  SHEET_FIELDS.RESEARCHER,\n  SHEET_FIELDS.FUNDER,\n  FEATURE_HEADERS.IMPLEMENTATION,\n  SHEET_FIELDS.TARGETING,\n  SHEET_FIELDS.UNIT,\n  SHEET_FIELDS.AMOUNT,\n  SHEET_FIELDS.FREQUENCY,\n  SHEET_FIELDS.EVALUATION,\n  SHEET_FIELDS.NOTES,\n  SHEET_FIELDS.WEBSITE,\n  COMPOSITE_FIELDS.RELATED_RESOURCES\n  // SHEET_FIELDS.LINKURL1,\n  // SHEET_FIELDS.LINKTITLE1,\n  // SHEET_FIELDS.LINKURL2,\n  // SHEET_FIELDS.LINKTITLE2,\n  // SHEET_FIELDS.LINKURL3,\n  // SHEET_FIELDS.LINKTITLE3,\n  // SHEET_FIELDS.LINKURL4,\n  // SHEET_FIELDS.LINKTITLE4,\n  // SHEET_FIELDS.LINKURL5,\n  // SHEET_FIELDS.LINKTITLE5,\n  // SHEET_FIELDS.LINKURL6,\n  // SHEET_FIELDS.LINKTITLE6\n];\n\nconst ORDERED_CSV_FIELDS = [\n  // SHEET_FIELDS.LONGITUDE,\n  // SHEET_FIELDS.LATITUDE,\n  // SHEET_FIELDS.EID,\n  SHEET_FIELDS.NAME,\n  // SHEET_FIELDS.TYPE,\n  SHEET_FIELDS.LOCATION,\n  SHEET_FIELDS.DATES,\n  SHEET_FIELDS.RECIPIENTS,\n  // FEATURE_HEADERS.ORGANIZATIONAL,\n  SHEET_FIELDS.IMPLEMENTER,\n  SHEET_FIELDS.RESEARCHER,\n  SHEET_FIELDS.FUNDER,\n  // FEATURE_HEADERS.IMPLEMENTATION,\n  SHEET_FIELDS.TARGETING,\n  SHEET_FIELDS.UNIT,\n  SHEET_FIELDS.AMOUNT,\n  SHEET_FIELDS.FREQUENCY,\n  SHEET_FIELDS.EVALUATION,\n  SHEET_FIELDS.NOTES,\n  SHEET_FIELDS.WEBSITE,\n  // COMPOSITE_FIELDS.RELATED_RESOURCES\n  SHEET_FIELDS.LINKURL1,\n  SHEET_FIELDS.LINKTITLE1,\n  SHEET_FIELDS.LINKURL2,\n  SHEET_FIELDS.LINKTITLE2,\n  SHEET_FIELDS.LINKURL3,\n  SHEET_FIELDS.LINKTITLE3,\n  SHEET_FIELDS.LINKURL4,\n  SHEET_FIELDS.LINKTITLE4,\n  SHEET_FIELDS.LINKURL5,\n  SHEET_FIELDS.LINKTITLE5,\n  SHEET_FIELDS.LINKURL6,\n  SHEET_FIELDS.LINKTITLE6\n];\n\nexport {\n  SHEET_FIELDS,\n  FEATURE_HEADERS,\n  COMPOSITE_FIELDS,\n  ORDERED_CARD_FIELDS,\n  ORDERED_CSV_FIELDS,\n  LINK_FIELD_PAIRS\n};","import React from 'react';\nimport TriggerIcon, { ICON_TYPE } from './TriggerIcon';\n\nclass UserHint extends React.Component {\n  render() {\n    let classes = 'user-hint';\n    if (this.props.classes) {\n      classes += ` ${this.props.classes}`;\n    }\n    if (this.props.dismissed) {\n      classes += ' dismissed';\n    }\n\n    let dismissTrigger = null;\n    if (this.props.onDismiss) {\n      dismissTrigger = <TriggerIcon iconType={ICON_TYPE.XCLOSE} onClick={this.props.onDismiss} />;\n    }\n    \n    return (\n      <div className={classes}>\n        {dismissTrigger}\n        <div className='content'>{this.props.content}</div>\n      </div>\n    )\n  }\n}\n\nexport default UserHint;\n","import React from 'react';\nimport _ from 'lodash';\nimport TriggerIcon, { ICON_TYPE } from './TriggerIcon';\nimport ExportFooter from './ExportFooter.js';\nimport { SHEET_FIELDS, ORDERED_CARD_FIELDS, ORDERED_CSV_FIELDS, COMPOSITE_FIELDS, LINK_FIELD_PAIRS } from './fields';\nimport UserHint from './UserHint';\n\nconst { LOCATION, NAME, EID, TYPE, WEBSITE } = SHEET_FIELDS;\n\n// time (in seconds) before the max card user hint auto-dismisses\nconst MAX_CARD_HINT_TIMEOUT = 30;\nconst SCROLL_THROTTLE_DELAY = 500;\n\n// pure component? (shallow compare map features?) (perf)\nclass CardDock extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    // FIELDS NO LONGER EXPANDIBLE\n    // uncomment 'expand' and 'toggle'-related code here & in CSS to reactivate\n    this.state = {\n      // expandedProperties: {},\n      scrollHintDismissed: false,  \n      maxPointHintDismissed: false,\n      mapMaskActive: false,\n      sideButtonsActive: false\n    };\n\n    this.removeCard = this.removeCard.bind(this);\n    this.updateMask = this.updateMask.bind(this);\n    // this.toggleProperty = this.toggleProperty.bind(this);\n    this.dismissMaxPointHint = this.dismissMaxPointHint.bind(this);\n    this.scrollUp = this.scrollUp.bind(this);\n    this.scrollDown = this.scrollDown.bind(this);\n    this.exportCSV = this.exportCSV.bind(this);\n    this.throttledUpdateMask = _.throttle(\n      this.throttledUpdateMask,\n      SCROLL_THROTTLE_DELAY,\n      { leading: true, trailing: true }\n    ).bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(newProps) {\n    if (newProps.cardData.length !== this.props.cardData.length) {\n      // necessary to ensure smooth height transitions\n      // this.setState({ expandedProperties: {} });\n\n      const cardWasRemoved = newProps.cardData.length < this.props.cardData.length;\n      if (cardWasRemoved && this.props.maxCardHintTriggered && !this.state.maxPointHintDismissed) {\n        // if a card is removed after hint is given, dismiss hint\n        this.dismissMaxPointHint();\n      }\n    }\n\n    if (!newProps.cardData.length) {\n      this.setState({ mapMaskActive: false });\n    }\n\n    if (newProps.maxCardHintTriggered !== this.props.maxCardHintTriggered) {\n      setTimeout(this.dismissMaxPointHint, 1000 * MAX_CARD_HINT_TIMEOUT);\n    }\n  }\n\n  removeCard(id) {\n    this.props.removeCard(id);\n  }\n\n  updateMask(e) {\n    this.throttledUpdateMask(e.deltaY);\n  }\n\n  throttledUpdateMask(deltaY) {\n    const { scrollTop } = this.props.appRef.current;\n\n    let mapMaskActive = false;\n    if (this.props.isTouchScreen) {\n      // no mask on mobile\n    } else if (deltaY > 0) {\n      // not really necessary with app ref but can't hurt\n      mapMaskActive = true;\n    } else if (scrollTop > 5) {\n      mapMaskActive = true;\n    }\n\n    const sideButtonsActive = scrollTop > 150;\n\n    this.setState({ scrollHintDismissed: true, sideButtonsActive, mapMaskActive });\n  }\n\n  // toggleProperty(property, expanded) {\n  //   const expandedProperties = {...this.state.expandedProperties};\n  //   expandedProperties[property] = !expanded;\n\n  //   // necessary to ensure smooth height transitions\n  //   try {\n  //     const elems = document.getElementsByClassName(`cell ${property}`);\n  //     const greatestHeight = _.max(_.map(elems, 'scrollHeight'));\n  //     _.each(elems, elem => {\n  //       elem.style.maxHeight = greatestHeight + 20 + 'px';\n  //     })\n  //   }\n  //   catch(e) {}\n\n  //   this.setState({ expandedProperties });\n  // }\n\n  getNames() {\n    // TODO: don't bind in render (perf)\n    return this.props.cardData.map((experimentCardSet, idx) => {\n      const {\n        [EID.sheetId]: eid,\n        [NAME.sheetId]: name,\n        [TYPE.sheetId]: type\n      } = experimentCardSet[0];\n      // add type to class so we can color-code\n      const classes = `card card-${idx} ${type}`;\n      return (\n        <div className={classes} key={'header'+eid} >\n          <div className='cell'>\n            {name||'(none)'}\n            <TriggerIcon iconType={ICON_TYPE.XCLOSE} onClick={this.removeCard.bind(this, eid)} />\n          </div>\n        </div>\n    )});\n  }\n\n  getRows() {\n    // form a row for each field\n    return ORDERED_CARD_FIELDS.map(field => {\n      const { displayName, sheetId, isFeatureHeader } = field;\n\n      // const expandible = this.getIsExpandible(field);\n\n      // const expanded = !!this.state.expandedProperties[sheetId];\n\n      let expandIcon = null;\n      // if (expandible) {\n      //   // TODO: also don't bind in render (perf)\n      //   const iconType = expanded ? ICON_TYPE.COLLAPSE : ICON_TYPE.EXPAND;\n      //   expandIcon = (\n      //     <TriggerIcon\n      //       onClick={this.toggleProperty.bind(this, sheetId, expanded)}\n      //       iconType={iconType}\n      //     />\n      //   );\n      // }\n\n      let cellClass = 'cell ' + sheetId;\n      // if (expandible) {\n      //   cellClass += ' expandible';\n      // }\n      // if (expanded) {\n      //   cellClass += ' expanded';\n      // }\n      if (isFeatureHeader) {\n        cellClass += ' feature-header';\n      }\n\n      // form a cell for each experiment for that field\n      const cells = this.props.cardData.map((experimentCardSet, idx) => {\n\n        const { [EID.sheetId]: eid } = experimentCardSet[0];\n        return (\n          <div className={`card card-${idx}`} key={displayName+eid}>\n            <div className={cellClass}>\n              <div className='property-name'>{displayName}{expandIcon}</div>\n              <div className={'value'}>{this.getCellContent(experimentCardSet, field)}</div>\n            </div>\n          </div>\n      )});\n      \n      return <div className='row' key={displayName}>{cells}</div>;\n    });\n  }\n\n  // whether a given row should be expandible (succinct cells don't need expand triggers)\n  // TODO: use ref, and after rerender check height, add classname accordingly?\n  // getIsExpandible(field) {\n  //   if (field === LOCATION) {\n  //     // if any experimint in the card dock has multiple locations, the location cell should be expandible\n  //     return _.some(this.props.cardData, expCardSet => expCardSet.length > 2);\n  //   }\n  //   // TODO: should fields designate isExpandible? if so, use here\n  //   if (field.isComposite || field.isFeatureHeader) {\n  //     // TODO: should composite rows (Related Resources be expandible? how to measure?)\n  //     return false;\n  //   }\n  //   if (_.some(this.props.cardData, expCardSet => this.getIsDifferentiated(expCardSet, field))) {\n  //     // if any selected experiment has differentiated data for the field, cell should be expandible\n  //     return true;\n  //   }\n\n  //   // if any experiment's value for the cell is longer than X characters\n  //   return _.some(this.props.cardData, expCardSet => {\n  //     // only need to check first location since we only hit this case if cell is undifferentiated\n  //     return expCardSet[0][field.sheetId].length > 120;\n  //   });\n  // }\n\n  // returns true if the data for a given field of a given experiment\n  // has differing values across experiment locations\n  getIsDifferentiated(experimentCardSet, field) {\n    if (field.forceUniformValue || experimentCardSet.length === 1) {\n      // certain fields we never let be differentiated\n      // and data can't be differentiated if there's only one location\n      return false;\n    }\n    const { sheetId } = field;\n    const [locationOneData, ...otherLocationsData] = experimentCardSet;\n    const firstValue = locationOneData[sheetId];\n    return _.some(otherLocationsData, l => l[sheetId] !== firstValue);\n  }\n\n  getCellContent(experimentCardSet, field) {\n    if (field === LOCATION) {\n      return this.getLocationCellContent(experimentCardSet);\n    } else if (field.isFeatureHeader) {\n      return null;\n    } else if (field === COMPOSITE_FIELDS.RELATED_RESOURCES) {\n      return this.getLinksContent(experimentCardSet);\n    }\n\n    const { sheetId } = field;\n    const firstValue = experimentCardSet[0][sheetId];\n\n    if (field === WEBSITE && firstValue.includes('.')) {\n      // make sure website is linkified if it's a link. otherwise it'll be caught\n      // by the next condition, for all undifferentiated fields\n      return <a href={firstValue} target='_blank' rel='noopener noreferrer'>{firstValue}</a>;\n    } else if (!this.getIsDifferentiated(experimentCardSet, field)) {\n      // for undifferentiated fields, the cell content is the field value\n      // for the first (and perhaps only) location\n      return firstValue;\n    }\n    // break cell into block for each location, as they have different values\n    return (\n      <>\n        {experimentCardSet.map(locationData => {\n          const {\n            [EID.sheetId]: eid,\n            [LOCATION.sheetId]: location,\n          } = locationData;\n          return (\n            <div key={`cell-content-${sheetId}-${eid}-${location}`}>\n              <div\n                title={location}\n                className='location-title'\n              >\n                {location}\n              </div>\n              {locationData[sheetId]}\n            </div>\n          )\n        })}\n      </>\n    );\n  }\n\n  getLocationCellContent(experimentCardSet) {\n    const cellContent = experimentCardSet.map(locationData => {\n      const {\n        [EID.sheetId]: eid,\n        [LOCATION.sheetId]: location,\n      } = locationData;\n      return (\n        <div\n          title={location}\n          className='location-cell-content'\n          key={`cell-content-location-${eid}-${location}`}\n        >\n          {location}\n        </div>\n    )});\n    return <>{cellContent}</>;\n  }\n\n  getLinksContent(experimentCardSet) {\n    const linkMap = {};\n    const orderedLinks = [];\n    experimentCardSet.forEach(locationData => {\n      LINK_FIELD_PAIRS.forEach(({ urlField, titleField }) => {\n        const urlValue = locationData[urlField.sheetId];\n        if (urlValue && !linkMap[urlValue]) {\n          linkMap[urlValue] = true;\n          const titleValue = locationData[titleField.sheetId] || urlValue;\n          orderedLinks.push({ urlValue, titleValue });\n        }\n      })\n    });\n\n    return (\n      <div\n        key={`cell-content-links-${experimentCardSet[0][EID.sheetId]}`}\n      >\n        {orderedLinks.map(({ urlValue, titleValue }) => (\n          <a key={urlValue} href={urlValue} target='_blank' rel='noopener noreferrer'>{titleValue}</a>\n        ))}\n      </div>\n    );\n  }\n\n  getScrollHint() {\n    const content = <>scroll for more {<TriggerIcon iconType={ICON_TYPE.D_ARROW} />}</>\n    return (\n      <UserHint\n        content={content}\n        classes={'scroll-hint'}\n        dismissed={this.state.scrollHintDismissed || this.props.maxCardHintTriggered}\n      />\n    );\n  }\n\n  getSelectionHint() {\n    const content = (\n      <>\n        click more map points to compare experiments<p className='maximum'>(max. 3)</p>\n        <TriggerIcon iconType={ICON_TYPE.R_ARROW} />\n      </>\n    );\n\n    let classes = 'selection-hint';\n    if (this.state.scrollHintDismissed) {\n      classes += ' scroll-initiated';\n    }\n    \n    return (\n      <UserHint\n        content={content}\n        classes={classes}\n        dismissed={this.props.selectionHintDismissed}\n      />\n    );\n  }\n  \n  getMaxPointHint() {\n    const content = <>Only 3 experiments may be viewed at once. Remove a card to add another experiment.</>\n\n    let classes = 'max-point-hint';\n    if (this.props.maxCardHintTriggered) {\n      classes += ' triggered'\n    }\n\n    return (\n      <UserHint\n        content={content}\n        classes={classes}\n        onDismiss={this.dismissMaxPointHint}\n        dismissed={this.state.maxPointHintDismissed}\n      />\n    );\n  }\n\n  dismissMaxPointHint() {\n    this.setState({ maxPointHintDismissed: true });\n  }\n\n  getSideButtons() {\n    let classes = 'side-buttons';\n    if (this.state.sideButtonsActive) {\n      classes += ' active';\n    }\n\n    return (\n      <div className={classes}>\n        <div className='scroll-up-button' onClick={this.scrollUp} title='Scroll to top' />\n        <div className='share-export' onClick={this.scrollDown} title='Scroll to export options' />  \n      </div>\n    )\n  }\n  \n  scrollUp() {\n    this.setState({ mapMaskActive: false, sideButtonsActive: false });\n    this.props.appRef.current.scroll({\n      top: 0,\n      behavior: 'smooth'\n    });\n  };\n  \n  scrollDown() {\n    this.props.appRef.current.scroll({\n      top: 10000, // big number (scroll all the way down)\n      behavior: 'smooth'\n    });\n  };\n\n  exportCSV() {\n    try {\n      const { cardData } = this.props;\n      const headers = _.map(ORDERED_CSV_FIELDS, 'displayName');\n\n      const valueArrays = [headers];\n      _.each(cardData, experimentCardSet => {\n        _.each(experimentCardSet, locationData => {\n          valueArrays.push(_.map(ORDERED_CSV_FIELDS, f => {\n            let v = locationData[f.sheetId];\n            // seems new lines are fine\n            // v = v.replace(/\\n/gm, ''); \n            v = v.replace(/\"/gm, \"'\");\n            return v ? `\"${v}\"` : \"\";\n          }));\n        });\n      });\n\n      let csv = '';\n      _.each(valueArrays, row => {\n        csv += row.join(',');\n        csv += '\\n';\n      })\n      \n      const hiddenElement = document.createElement('a');\n      // encodeURI broke on #:\n      // https://stackoverflow.com/questions/55267116/how-to-download-csv-using-a-href-with-a-number-sign-in-chrome\n      hiddenElement.href = 'data:text/csv;charset=UTF-8,' + encodeURIComponent(csv);\n      hiddenElement.target = '_blank';\n      hiddenElement.download = 'BILData.csv';\n      hiddenElement.click();\n      hiddenElement.remove();\n    } catch (error) {\n      console.error('Unable to export to CSV. Please try again. ' + error);\n    }\n  }\n\n  render() {\n    if (!this.props.cardData.length) {\n      return null;\n    }\n    \n    const classes = `card-dock card-count-${this.props.cardData.length}`;\n\n    let maskClass = 'card-dock-mask';\n    if (this.state.mapMaskActive) {\n      maskClass += ` active card-count-${this.props.cardData.length}`;\n    }\n    return (\n      <div className={maskClass} onWheel={this.updateMask} onTouchMove={this.updateMask}>\n        <div\n          onWheel={this.updateMask}\n          onTouchMove={this.updateMask}\n          className={'card-dock-container'}\n        >\n          <div className={classes}>\n            <div className='card-table'>\n            {this.getScrollHint()}\n            {this.getSelectionHint()}\n            {this.getMaxPointHint()}\n            <div className='row header'>{this.getNames()}</div>\n            {this.getRows()}\n            {this.getSideButtons()}\n            </div>\n          </div>\n          <ExportFooter exportCSV={this.exportCSV} />\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default CardDock;\n","import React from 'react';\nimport TriggerIcon, { ICON_TYPE } from './TriggerIcon';\n\nconst SECTIONS = [\n  { \n    name: 'Introduction',\n    text: 'How and where have Universal Basic Income (UBI) and its cousin policies been tested? What are some significant differences between these programs and which features do they share with an ideal UBI policy? What impacts can be measured when giving individuals unconditional cash on a regular basis? This geospatial map presents UBI-related experiments, pilots, programs and policies throughout the world, some past and some ongoing, and enables the user to compare them across a range of design and implementation features. It sheds light on many basic income related experiments over the past 60 years in order to inform the current dialogue around a potential basic income policy in the United States and beyond.'\n  },\n  { \n    name: 'How to Use',\n    text: 'To view more information about each experiment on the map, click or tap on a dot. A card will appear containing the name of the experiment, and you can scroll or swipe to view a full table of data. Click up to 3 cards to compare the experiments’ features side by side. FULL EXPLAINER TK'\n  },\n  { \n    name: 'Inclusion Criteria',\n    text: 'The map contains experiments, pilots, policies and programs that have design and implementation features that crossover with the key principles of a universal basic income: unconditional, universal, regular, individual, and paid in cash.',\n    text2: 'As described in the review of the State of the Evidence on Universal Basic Income-type programs: An Umbrella Review (Hasdell, forthcoming), experiments used to draw conclusions about UBI include the following categories of cash transfers: unconditional and universal cash to supplemental income schemes to resource dividends and minimum income guarantees (through a negative income tax).',\n    text3: 'The experiments, pilots, policies and programs we have included in this geospatial map all share multiple of the aforementioned features of a universal basic income policy and are frequently cited in the basic income literature used to infer potential impacts of a basic income policy (see Hoynes and Rothstein, 2019; Gentilini et. al, 2019, and Banerjee et. al, 2019; and Gibson et. al, 2018).',\n    text4: 'The Basic Income Lab included these experiments for this current version. Over time, we hope to add more experiments as they come to light.'\n  },\n  { \n    name: 'Citation',\n    text: 'Please cite as follows: Stanford Basic Income Lab [cartographer]. (2020). Global Map of Basic Income Experiments [map]. Retrieved from https://hyperobjekt.github.io/bil-map/'\n  }\n];\n\nclass IntroPanel extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const startOpen = window.innerWidth > 600;\n    this.state = { open: startOpen, activeSectionIdx: 0 };\n\n    this.toggleOpen = this.toggleOpen.bind(this);\n    this.setActiveSection = this.setActiveSection.bind(this);\n    this.advanceActiveSection = this.advanceActiveSection.bind(this);\n    this.prevActiveSection = this.prevActiveSection.bind(this);\n  }\n\n  toggleOpen() {\n    this.setState(state => ({ open: !state.open }));\n  }\n\n  getHeader() {\n    return (\n      <div className='header'>\n        <div className='info'><TriggerIcon iconType={ICON_TYPE.INFO_ICON} /></div>\n        <h1>Map of Universal Basic Income Experiments and Related Programs</h1>\n      </div>\n    );\n  }\n\n  getNav() {\n    const sections = SECTIONS.map((s, i) => {\n      let classes = 'section-name';\n      if (i === this.state.activeSectionIdx) {\n        classes += ' active';\n      }\n      return <p className={classes} onClick={this.setActiveSection.bind(this, i)} key={s.name}>{s.name}</p>;\n    });\n\n    return(\n      <div className='nav'>\n        {sections}\n      </div>\n    )\n  }\n\n  getSection() {\n    const { activeSectionIdx } = this.state;\n    return (\n      <div className='section-text'>\n        <p>{SECTIONS[activeSectionIdx].text}</p>\n        <p>{SECTIONS[activeSectionIdx].text2}</p>\n        <p>{SECTIONS[activeSectionIdx].text3}</p>\n        <p>{SECTIONS[activeSectionIdx].text4}</p>\n      </div>\n    );\n  }\n  \n  getNextPrev() {\n    const { activeSectionIdx } = this.state;\n\n    let prevHandler = null;\n    let prevClasses = 'advance-button prev'\n    if (activeSectionIdx !== 0) {\n      prevHandler = this.prevActiveSection;\n      prevClasses += ' active';\n    }\n    const prevButton = (\n      <p className={prevClasses} onClick={prevHandler}>\n        <TriggerIcon iconType={ICON_TYPE.L_ARROW_STEMLESS} />\n        PREVIOUS\n      </p>\n    );\n\n    let nextHandler = null;\n    let nextClasses = 'advance-button next'\n    if (activeSectionIdx < (SECTIONS.length - 1)) {\n      nextHandler = this.advanceActiveSection;\n      nextClasses += ' active';\n    }\n    const nextButton = (\n      <p className={nextClasses} onClick={nextHandler}>\n        NEXT\n        <TriggerIcon iconType={ICON_TYPE.R_ARROW_STEMLESS} />\n      </p>\n    );\n    return (\n      <div className='bottom-controls'>\n        <div className=\"next-prev\">{prevButton} {nextButton}</div>\n      </div>\n    );\n  }\n  \n  setActiveSection(activeSectionIdx) {\n    this.setState({ activeSectionIdx });\n  }\n  \n  advanceActiveSection() {\n    this.setState(state => ({ activeSectionIdx: state.activeSectionIdx + 1 }));\n  }\n\n  prevActiveSection() {\n    this.setState(state => ({ activeSectionIdx: state.activeSectionIdx - 1 }));\n  }\n\n  render() {\n    let classes = 'intro-panel-wrapper';\n    if (!this.state.open) {\n      classes += ' closed';\n    }\n\n    const iconType = this.state.open ? ICON_TYPE.L_ARROW_STEMLESS : ICON_TYPE.R_ARROW_STEMLESS;\n    const title = this.state.open ? 'Close' : 'Open';\n    return (\n      <div className={classes}> \n        <div className='mobile-trigger'>\n          <TriggerIcon className title={title} onClick={this.toggleOpen} iconType={ICON_TYPE.INFO_ICON} />\n        </div>\n        <div className='trigger'>\n          <TriggerIcon title={title} onClick={this.toggleOpen} iconType={iconType} />\n        </div>\n        <div className='intro-panel'>\n          <div className='content'>\n            {this.getHeader()}\n            {this.getNav()}\n          </div>\n          <div className='content-body'> \n            {this.getSection()}\n          </div> \n          <div className='content-nav'> \n            {this.getNextPrev()}\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default IntroPanel;\n","import React from 'react';\nimport TriggerIcon, { ICON_TYPE } from './TriggerIcon';\n\nclass Legend extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const startExpanded = window.innerWidth > 600;\n    this.state = { expanded: startExpanded };\n\n    this.toggleExpand = this.toggleExpand.bind(this);\n  }\n\n  toggleExpand() {\n    this.setState(state => ({ expanded: !state.expanded }));\n  }\n\n  render() {\n    const { expanded } = this.state;\n\n    let classes = 'legend';\n    if (!expanded) {\n      classes += ' hidden';\n    }\n\n    const title = expanded ? 'Hide Legend' : 'Show Legend';\n\n    const iconType = expanded ? ICON_TYPE.XCLOSE : ICON_TYPE.LEGEND;\n    return (\n      <div className={classes}>\n          <TriggerIcon title={title} onClick={this.toggleExpand} iconType={iconType} />\n          <div className='content'>\n            <div><i className='past' />Past Experiments</div>\n            <div><i className='ongoing' />Ongoing Experiments</div>\n            <div><i className='proposed' />Proposed Experiments</div>\n          </div>\n      </div>\n    )\n  }\n}\n\nexport default Legend;\n","import React from 'react';\n\nclass LoadingMask extends React.Component {\n  render() {\n    const { dataLoaded, mapLoaded, mapConfigured } = this.props;\n    let classes = 'mask';\n    if (dataLoaded && mapLoaded && mapConfigured) {\n      classes += ' loaded'\n    }\n    \n    return (\n      <div className={classes}>\n        <div className='content'>\n          <p>Loading...</p>\n          <div className='loading-dots'>\n            <div></div>\n            <div></div>\n            <div></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default LoadingMask;\n","import React from 'react';\n\nconst POINT_BUFFER = 7;\n\nclass Tooltip extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      left: 0,\n      top: 0,\n      adjusted: false\n    };\n\n    this.ref = React.createRef();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { expId } = nextProps;\n    if (this.props.expId === expId || !expId) {\n      // if we're still hovering the same point, don't worry about updating\n      return;\n    }\n\n    // The following steps insure a tooltip doesn't flow outside of the window bounds:\n    // 1] when we hover a new point, we initially render without adjusting the tooltip location\n    this.setState({ \n      adjusted: false,\n      left: nextProps.x,\n      top: nextProps.y\n    });\n  }\n\n  componentDidUpdate() {\n    if (this.state.adjusted || !this.props.expId) {\n      // 6] location has already been adjusted, so don't trigger a rerender\n      return;\n    }\n\n    this.adjustPosition();\n  }\n\n  adjustPosition() {\n    // 3] after the initial render, we have access to the tooltip's DOM node and can tell it's size\n    const { width: tooltipWidth, height: tooltipHeight } = this.ref.current.getBoundingClientRect();\n    const windowElement = document.getElementById('root');\n    const { width: windowWidth, height: windowHeight } = windowElement.getBoundingClientRect();\n    \n    let { left, top } = this.state;\n    // by default, tooltip appears above the point\n    top -= (tooltipHeight + POINT_BUFFER);\n    if (top < 0) {\n      // if it would run off the top of the screen, shift it below the point\n      top += tooltipHeight + POINT_BUFFER*2;\n\n      if ((top + tooltipHeight) > windowHeight) {\n        // ...unless it would then run off the bottom, in which case set it as high as possible\n        top = 1;\n      }\n    }\n\n    left += POINT_BUFFER;\n    if (left + tooltipWidth > windowWidth) {\n      // if the tooltip would run off the right of the screen, shift it left of the point\n      left -= (tooltipWidth + POINT_BUFFER*2);\n\n      if (left < 0) {\n        // ...unless it would then run off the left, in which case set it up against the right border\n        left = windowWidth - (tooltipWidth + 2);\n      }\n    }\n\n    // 4] record our adjusted coordinates, which will trigger a rerender\n    this.setState({ left, top, adjusted: true });\n  }\n  \n  getLocations() {\n    const { location, otherLocations } = this.props;\n    let hoveredClass = 'hovered-location';\n    let otherLocationElements = null;\n\n    if (otherLocations.length) {\n      hoveredClass += ' emphasized';\n      otherLocationElements = otherLocations.map(l => <p key={l}>{l}</p>);\n    }\n\n    return (\n      <>\n        <p className={hoveredClass}>{location}</p>\n        {otherLocationElements}\n      </>\n    )\n  }\n\n  render() {\n    const { expId, name, type } = this.props;\n    if (!expId) {\n      return null;\n    }\n\n    let style = {};\n    if (!this.state.adjusted) {\n      // 2] hide this initial render so user doesn't see tooltip \"jump\"\n      style = { visibility: 'hidden', left: '0px', top: '0px' };\n    } else {\n      // 5] finally, our tooltip can be told where to properly render\n      style = { left: this.state.left + 'px', top: this.state.top + 'px' };\n    }\n\n    const classes = 'tooltip ' + type;\n    return (\n      <div className={classes} style={style} ref={this.ref}>\n        <div className='name'>{name||'(none)'}</div>\n        <div className='detail'>\n          <p className='location-title'>Location:</p>\n          {this.getLocations()}\n        </div>\n        <p className='click-hint'>click point for more info</p>\n      </div>\n    )\n  }\n}\n\nexport default Tooltip;\n","import './mapbox-gl.css';\nimport './mapbox-gl-ctrl-zoom-in.svg';\nimport './mapbox-gl-ctrl-zoom-out.svg';\nimport './mapbox-gl-ctrl-attrib.svg';\nimport './mapbox-gl-ctrl-logo.svg';\nimport './App.scss';\nimport CardDock from './CardDock';\nimport IntroPanel from './IntroPanel';\nimport Legend from './Legend';\nimport LoadingMask from './LoadingMask';\nimport React from 'react';\nimport Tooltip from './Tooltip';\nimport _ from 'lodash';\nimport mapboxgl from 'mapbox-gl';\nimport styleData from './style.json';\nimport { SHEET_FIELDS } from './fields';\n\nconst { LONGITUDE, LATITUDE, NAME, LOCATION, TYPE, EID } = SHEET_FIELDS;\n\nmapboxgl.accessToken = process.env.REACT_APP_MAPBOX_TOKEN;\nconst MAX_SELECTED_POINTS = 3;\nconst STARTING_LNG = -30;\nconst STARTING_LAT = 29;\nconst STARTING_ZOOM = 1.5;\nconst CONTROL_QUERY_STRING = true;\nconst QUERY_STRING_BASE = '?s='; // KEEP IN SYNC WITH BIL-SITE\nconst ORIGIN_PARAM_MARKER = '&o='; // KEEP IN SYNC WITH BIL-SITE\nconst DEFAULT_APP_ORIGIN = 'https://map-embed--bil-staging.netlify.app';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      dataLoaded: false,\n      mapLoaded: false,\n      mapConfigured: false,\n      isTouchScreen: false,\n      selectionHintDismissed: false,\n      maxCardHintTriggered: false,\n      hovered: {},\n      selectedIds: []\n    };\n\n    this.mapContainer = React.createRef();\n    this.appRef = React.createRef();\n    this.map = null;\n\n    this.getCardDock = this.getCardDock.bind(this);\n    this.getTooltip = this.getTooltip.bind(this);\n    this.removeCard = this.removeCard.bind(this);\n    this.getFeaturesByExperimentId = this.getFeaturesByExperimentId.bind(this);\n    this.resetUSView = this.resetUSView.bind(this);\n    this.resetWorldView = this.resetWorldView.bind(this);\n  }\n\n  componentDidMount() {\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer.current,\n      style: styleData,\n      center: [STARTING_LNG, STARTING_LAT],\n      zoom: STARTING_ZOOM,\n      maxBounds: [\n        [-170.99, -80], // SW coordinates\n        [189, 85] // NE coordinates\n      ]\n    });\n\n    if (window.innerWidth < 800) {\n      // for smaller screens, initialize view on US\n      this.resetUSView();\n    }\n\n    this.map.addControl(new mapboxgl.NavigationControl());\n    // disable map rotation using right click + drag\n    this.map.dragRotate.disable();\n    // disable map rotation using touch rotation gesture\n    this.map.touchZoomRotate.disableRotation();\n\n    this.map.on('load', this.markMapLoaded.bind(this));\n\n    this.map.on('move', _.debounce(() => {\n      this.featuresOnUnhover();\n      console.log('lat: ', this.map.getCenter().lat.toFixed(4));\n      console.log('lng: ', this.map.getCenter().lng.toFixed(4));\n      console.log('zoom: ', this.map.getZoom().toFixed(2));\n    }, 800, { leading: true, trailing: false }));  \n    \n    this.map.on('click', 'experimentSites', this.featuresOnClick.bind(this));\n    this.map.on('mouseenter', 'experimentSites', this.featuresOnHover.bind(this));\n    this.map.on('mouseleave', 'experimentSites', this.featuresOnUnhover.bind(this));\n\n    this.map.on('touchstart', _.debounce(\n      this.registerTouchScreen.bind(this),\n      3000,\n      { leading: true, trailing: false }\n    ));\n    \n    load.call(this); \n  }\n  \n  markMapLoaded() {\n    this.setState({ mapLoaded: true });\n  }\n\n  registerTouchScreen() {\n    // just fire once\n    if (this.state.isTouchScreen) {\n      return;\n    }\n    // make points more clickable on mobile\n    this.map.setPaintProperty('experimentSites','circle-stroke-width', 8);\n    this.setState({ isTouchScreen: true });\n  }\n\n  getFeaturesByExperimentId(expId) {\n    const { features } = this.map.getSource('experiments')._data;\n    return features.filter(f => f.id === expId).map(f => f.properties);\n  }\n  \n  featuresOnClick(e) {\n    const { id: expId } = e.features[0];\n    const selectedIds = [...this.state.selectedIds];\n    const idx = selectedIds.indexOf(expId);\n    const alreadySelected = idx > -1;\n\n    if (!alreadySelected) {\n      if (selectedIds.length >= MAX_SELECTED_POINTS) {\n        this.setState({ maxCardHintTriggered: true });\n        return;\n      } else {\n        selectedIds.push(expId);\n      }\n    } else {\n      selectedIds.splice(idx, 1);\n    }\n\n    if (CONTROL_QUERY_STRING) {\n      this.updatePageURL(selectedIds);\n    }\n\n    // dismiss selection hint once multiple points have been selected\n    const selectionHintDismissed = (selectedIds.length > 1) || this.state.selectionHintDismissed;\n    this.setState({ selectedIds, selectionHintDismissed });\n    this.map.setFeatureState({\n        source: 'experiments',\n        id: expId\n      }, { selected: !alreadySelected }\n    );\n  }\n\n  featuresOnHover(e) {\n    if (this.state.isTouchScreen) {\n      // devices with touch screens shouldn't have tooltips\n      return;\n    }\n    this.map.getCanvas().style.cursor = 'pointer';\n    const { id: expId, properties } = e.features[0];    \n    const { x, y } = e.point;\n\n    this.setState({ \n      hovered: {\n        name: properties[NAME.sheetId],\n        location: properties[LOCATION.sheetId],\n        type: properties[TYPE.sheetId],\n        expId,\n        x,\n        y \n      }\n    });\n    this.map.setFeatureState({\n        source: 'experiments',\n        id: expId\n      }, { hover: true }\n    );\n  }\n\n  featuresOnUnhover() {\n    if (this.state.isTouchScreen || !this.state.hovered.expId) {\n      return;\n    }\n    this.map.getCanvas().style.cursor = '';\n    this.map.setFeatureState({\n        source: 'experiments',\n        id: this.state.hovered.expId\n      }, { hover: false }\n    );\n\n    this.setState({ hovered: {} });\n  }\n\n  removeCard(expId) {\n    const selectedIds = [...this.state.selectedIds];\n    const idx = selectedIds.indexOf(expId);\n    selectedIds.splice(idx, 1);\n\n    if (CONTROL_QUERY_STRING) {\n      this.updatePageURL(selectedIds);\n    }\n\n    this.setState({ selectedIds });\n    this.map.setFeatureState({\n        source: 'experiments',\n        id: expId\n      }, { selected: false }\n    );\n  }\n\n  getTooltip() {\n    const { expId, name, location, type, x, y } = this.state.hovered;\n    let otherLocations = [];\n    if (expId) {\n      const features = this.getFeaturesByExperimentId(expId);\n      otherLocations = features\n        .map(f => f.location)\n        .filter(l => l !== location);\n    }\n    return <Tooltip expId={expId} name={name} location={location} otherLocations={otherLocations} type={type} x={x} y={y}/>;\n  }\n\n  getCardDock() {\n    if (!this.map) {\n      return null;\n    }\n\n    const { selectedIds, isTouchScreen, selectionHintDismissed, maxCardHintTriggered } = this.state;\n    const cardData = selectedIds.map(this.getFeaturesByExperimentId);\n    return (\n      <CardDock\n        removeCard={this.removeCard}\n        cardData={cardData}\n        isTouchScreen={isTouchScreen}\n        selectionHintDismissed={selectionHintDismissed}\n        maxCardHintTriggered={maxCardHintTriggered}\n        appRef={this.appRef}\n      />\n    );\n  }\n\n  resetWorldView() {\n    this.map.flyTo({\n      center: [STARTING_LNG, STARTING_LAT],\n      zoom: STARTING_ZOOM,\n      essential: true\n    });\n  }\n\n  resetUSView() {\n    this.map.fitBounds([\n      [-128, 24],\n      [-65, 50]\n    ]);\n  }\n\n  getResetViewButton() {\n    const onClick = () => {window.innerWidth > 800 ? this.resetWorldView() : this.resetUSView()}\n\n    return (\n      <div className='mapboxgl-ctrl mapboxgl-ctrl-group custom'>\n        <button\n          onClick={onClick}\n          className='mapboxgl-ctrl-reset-view'\n          type='button'\n          title='Reset view'\n          aria-label='Reset view'\n        >\n          <span className='mapboxgl-ctrl-icon' aria-hidden='true' />\n        </button>\n      </div>\n    );\n  }\n\n  updatePageURL(selectedIds) {\n    let queryString = '.'; // functions to clear query param\n    if (selectedIds.length) {\n      const idString = selectedIds.map(numId => numericToStringEidMap[numId]).join(',');\n      queryString = QUERY_STRING_BASE + idString;\n    }\n    // console.log('UPDATE URL with ', queryString);\n    window.parent.postMessage({ selectedIds: selectedIds, queryString }, this.appOrigin || DEFAULT_APP_ORIGIN);\n  }\n  \n  render() {\n    const { dataLoaded, mapLoaded, mapConfigured } = this.state;\n    const loading = !dataLoaded || !mapLoaded || !mapConfigured;\n    let classes = 'app';\n    if (loading) {\n      classes += ' loading';\n    }\n    return (\n      <div>\n        <LoadingMask dataLoaded={dataLoaded} mapLoaded={mapLoaded} mapConfigured={mapConfigured} />\n        <div className={classes} ref={this.appRef}>\n          <IntroPanel />\n          {this.getCardDock()}\n          {this.getTooltip()}\n          {this.getResetViewButton()}\n          <div ref={this.mapContainer} className='map-container' />\n          <Legend />\n        </div>\n      </div>\n    );\n  }\n}\n\nlet nextEidNumber = 1;\nconst stringToNumericEidMap = {};\nconst numericToStringEidMap = {};\n\nfunction load () {\n  // startsWith polyfill\n  if (!String.prototype.startsWith) {\n    Object.defineProperty(String.prototype, 'startsWith', {\n        value: function(search, rawPos) {\n            const pos = rawPos > 0 ? rawPos|0 : 0;\n            return this.substring(pos, pos + search.length) === search;\n        }\n    });\n  }\n\n  const experimentsData = { type: 'FeatureCollection', features: [] };\n\n  const reqHandler = (source, req) => {\n    const [ columnHeaderRow, ...rows ] = JSON.parse(req.responseText).feed.entry;\n    const properties = Object.keys(rows[0])\n      .filter(function (p) { \n        return p.startsWith('gsx$') & !p.endsWith('_db1zf');\n      })\n      .map(function (p) { return p.substr(4); });\n    \n    const items = rows.map(function (r, ri) {\n      const row = {};\n      properties.forEach(function (p) {\n        row[p] = r['gsx$' + p].$t === '' ? null : r['gsx$' + p].$t;\n        if ([LATITUDE.sheetId, LONGITUDE.sheetId].indexOf(p) !== -1) {\n          // mapbox wants numeric lat/long\n          row[p] = +row[p];\n        }\n        if (p === EID.sheetId) {\n          // convert the string eids from the sheet into numeric ids (which mapbox expects)\n          const stringEid = row[p];\n          const numericEid = stringToNumericEidMap[stringEid] || nextEidNumber++;\n          stringToNumericEidMap[stringEid] = numericEid;\n          // populate to use for sending query params\n          numericToStringEidMap[numericEid] = stringEid;\n          row[p] = numericEid;\n        }\n        if (p === TYPE.sheetId) {\n          // force lower case to simplify equality comparisons\n          row[p] = row[p].toLowerCase();\n        }\n        if (row[p] === null) {\n          row[p] = '';\n        }\n      });\n      return {\n        type: 'Feature',\n        id: row[EID.sheetId],\n        geometry: {\n          type: 'Point',\n          coordinates: [row[LATITUDE.sheetId], row[LONGITUDE.sheetId]]\n        },\n        properties: row\n      };\n    });\n    \n    experimentsData.features.push(...items);\n    this.map.getSource('experiments').setData(experimentsData);\n    this.setState({ mapConfigured: true });\n\n    if (CONTROL_QUERY_STRING) {\n      try {\n        const queryString = window.location.search;\n        const startingIdx = queryString.indexOf(QUERY_STRING_BASE) + QUERY_STRING_BASE.length;\n        const endingIndex = queryString.indexOf(ORIGIN_PARAM_MARKER);\n        let idString = '';\n        if (endingIndex > -1) {\n          this.appOrigin = queryString.slice(endingIndex + ORIGIN_PARAM_MARKER.length);\n          idString = queryString.slice(startingIdx, endingIndex);\n        } else {\n          idString = queryString.slice(startingIdx);\n        }\n\n        if (!idString.length) {\n          return;\n        }\n        let selectedIds = idString.split(',').map(s => {\n          const numericEid = stringToNumericEidMap[s];\n          if (!numericEid) {\n            console.error(`${s} does not correspond to an experiment id - ignoring.`)\n          }\n          return numericEid;\n        });\n\n        selectedIds = _.compact(selectedIds);\n        selectedIds = _.uniq(selectedIds);\n        selectedIds = selectedIds.slice(0, MAX_SELECTED_POINTS);\n\n        this.updatePageURL(selectedIds);\n        if (!selectedIds.length) {\n          return;\n        }\n\n        const selectionHintDismissed = selectedIds.length > 1;\n        this.setState({ selectedIds, selectionHintDismissed });\n        _.each(selectedIds, id => {\n          this.map.setFeatureState({\n            source: 'experiments',\n            id,\n          }, { selected: true });\n        });\n      } catch (error) {\n        console.error('Unable to load experiments.');\n      }\n    }\n  }\n\n  // Fetch Local Article Data\n  const experimentsReq = new XMLHttpRequest();\n  this.setState({ dataLoaded: true });\n  experimentsReq.addEventListener('load',  () => { reqHandler('experiments', experimentsReq) });\n  experimentsReq.open('GET', process.env.REACT_APP_SHEET_URL);\n  experimentsReq.send();\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}