(this["webpackJsonpubi-map"]=this["webpackJsonpubi-map"]||[]).push([[0],{13:function(e){e.exports=JSON.parse('{"version":8,"id":"ubi-experiments","name":"UBI Experiment Map","sprite":"https://tiles.evictionlab.org/sprites","sources":{"composite":{"url":"mapbox://mapbox.mapbox-streets-v7","type":"vector"},"us-cities-10":{"type":"vector","maxzoom":10,"tiles":["https://tiles.evictionlab.org/evictions-cities-10/{z}/{x}/{y}.pbf"],"attribution":""},"us-states-10":{"type":"vector","maxzoom":10,"tiles":["https://tiles.evictionlab.org/evictions-states-10/{z}/{x}/{y}.pbf"],"attribution":""},"experiments":{"type":"geojson","data":{"type":"FeatureCollection","features":[]}}},"glyphs":"https://openmaptiles.evictionlab.org/fonts/{fontstack}/{range}.pbf","layers":[{"id":"background","type":"background","minzoom":1,"paint":{"background-color":"#f8f8f9"}},{"id":"water","type":"fill","source":"composite","source-layer":"water","filter":["==","$type","Polygon"],"layout":{"visibility":"visible"},"paint":{"fill-color":"#ececef","fill-outline-color":"#e3e3e7"}},{"id":"roads","type":"line","source":"composite","source-layer":"road","minzoom":10,"filter":["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"rgba(150,150,150,1)","line-width":{"stops":[[10,0],[13,1],[14,2]]},"line-opacity":{"stops":[[10,0],[14,1]]}}},{"id":"highways","type":"line","source":"composite","source-layer":"road","minzoom":7,"filter":["all",["==","$type","LineString"],["all",["==","class","motorway"]]],"layout":{"line-cap":"round","line-join":"round","visibility":"visible"},"paint":{"line-color":"rgba(150,150,150,1)","line-width":{"stops":[[10,0],[12,1],[14,3]]},"line-opacity":{"stops":[[10,0],[12,1],[14,1]]}}},{"id":"boundary_state","type":"line","source":"us-states-10","source-layer":"states","layout":{"line-cap":"round","line-join":"bevel","visibility":"visible"},"paint":{"line-color":"rgba(248, 153, 156, 1)","line-width":{"stops":[[3,1],[7,2]]},"line-blur":0.4,"line-opacity":0.8}},{"id":"roads-highways_text","type":"symbol","source":"composite","source-layer":"road_label","minzoom":11,"filter":["in","class","motorway","primary","secondary","tertiary","trunk"],"layout":{"text-size":13,"text-max-angle":45,"text-transform":"none","symbol-spacing":250,"text-font":["Lato+Bold"],"symbol-placement":"line","text-rotation-alignment":"map","text-pitch-alignment":"viewport","text-field":"{name}","text-letter-spacing":0.05,"text-keep-upright":true},"paint":{"text-color":"rgba(5, 4, 3, 1)","text-halo-color":"rgba(255,255,255,1)","text-translate":[0,0],"text-halo-width":2,"text-halo-blur":1}},{"id":"experimentSites","type":"circle","source":"experiments","paint":{"circle-color":["case",["==",["get","type"],"past"],"rgb(0,80,92)",["==",["get","type"],"proposed"],"rgb(223,70,73)",["==",["get","type"],"ongoing"],"rgb(175,105,12)","gray"],"circle-opacity":0.8,"circle-radius":["interpolate",["exponential",1.3],["zoom"],1,["*",1,["case",["boolean",["feature-state","selected"],false],8.5,["boolean",["feature-state","hover"],false],7,5]],10,["*",8,["case",["boolean",["feature-state","selected"],false],8.5,["boolean",["feature-state","hover"],false],7,5]]],"circle-blur":["case",["boolean",["feature-state","hover"],false],0.2,["boolean",["feature-state","selected"],false],0,0]}},{"id":"cluster_count","type":"symbol","source":"experiments","filter":["has","point_count"],"layout":{"text-field":"{point_count_abbreviated}","text-font":["Lato+Bold"],"text-size":11},"paint":{"text-color":"rgb(255,255,255)"}},{"id":"city_extra_small_labels","type":"symbol","source":"us-cities-10","source-layer":"cities-centers","minzoom":10,"filter":["all",[">=","p-10",50000],["<","p-10",75000]],"layout":{"text-size":{"stops":[[10,10],[12,14]]},"text-transform":"uppercase","text-font":["Lato+Bold"],"text-justify":"left","text-offset":[-2,-1],"text-anchor":"left","text-field":"{n}","text-padding":0.5,"text-letter-spacing":0.13},"paint":{"text-color":"rgba(102, 102, 102, 1)","text-halo-color":"rgba(255, 255, 255, 1)","text-halo-width":{"stops":[[1,2],[11,3]]},"text-halo-blur":1,"text-opacity":1}},{"id":"city_small_labels","type":"symbol","source":"us-cities-10","source-layer":"cities-centers","minzoom":8,"filter":["all",[">=","p-10",75000],["<","p-10",100000]],"layout":{"text-size":{"stops":[[6,12],[10,16]]},"text-transform":"uppercase","text-font":["Lato+Bold"],"text-justify":"left","text-field":"{n}","text-letter-spacing":{"stops":[[6,0.12],[10,0.12]]},"text-padding":2,"text-offset":["interpolate",["linear"],["zoom"],6,["literal",[-1,-0.5]],12,["literal",[-2,-1]]]},"paint":{"text-color":"rgba(102, 102, 102, 1)","text-halo-color":"rgba(255, 255, 255, 1)","text-halo-width":{"stops":[[6,1],[10,2]]},"text-halo-blur":1,"icon-opacity":0,"text-opacity":1}},{"id":"city_mid_labels","type":"symbol","source":"us-cities-10","source-layer":"cities-centers","minzoom":6,"maxzoom":14,"filter":["all",[">=","p-10",100000],["<","p-10",500000]],"layout":{"text-size":{"stops":[[5,12],[10,15]]},"text-transform":"uppercase","text-font":["Lato+Bold"],"text-justify":"center","text-anchor":"center","text-field":"{n}","text-padding":0,"text-letter-spacing":0.12,"icon-allow-overlap":true,"icon-ignore-placement":true,"text-offset":["interpolate",["linear"],["zoom"],6,["literal",[-1,-0.5]],10,["literal",[-2,-1]]]},"paint":{"text-color":{"stops":[[5,"rgba(5, 4, 3, 1)"],[10,"rgba(102, 102, 102, 1)"]]},"text-halo-color":"rgba(255, 255, 255, 1)","text-halo-width":{"stops":[[5,2],[6,2]]},"text-halo-blur":1,"icon-opacity":1,"icon-color":"rgba(0, 0, 0, 1)"}},{"id":"city_large_labels","type":"symbol","source":"us-cities-10","source-layer":"cities-centers","minzoom":6,"maxzoom":14,"filter":[">=","p-10",500000],"layout":{"text-size":{"stops":[[6,14],[10,20]]},"text-transform":"uppercase","text-font":["Lato+Bold"],"text-justify":"center","text-anchor":"center","text-field":"{n}","text-padding":0,"text-letter-spacing":0.12,"icon-allow-overlap":true,"icon-ignore-placement":true,"text-offset":["interpolate",["linear"],["zoom"],6,["literal",[-1,-0.5]],10,["literal",[-2,-1]]]},"paint":{"text-color":"rgba(5, 4, 3, 1)","text-halo-color":"rgba(255, 255, 255, 1)","text-halo-width":{"stops":[[5,2],[6,2]]},"text-halo-blur":1,"icon-opacity":1,"icon-color":"rgba(0, 0, 0, 1)"}}]}')},16:function(e,t,a){e.exports=a(25)},21:function(e,t,a){},24:function(e,t,a){},25:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(12),r=a.n(o),s=(a(21),a(10)),l=a(2),c=a(3),u=a(5),p=a(4),d=a(1),m=a(6),h=a(14),f=a(15),y=a(8),g=a.n(y),x="remove",v="expand",b="collapse",k=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(p.a)(t).call(this,e))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"onClick",value:function(){this.props.onClick()}},{key:"getRemove",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("line",{x1:"15",x2:"85",y1:"15",y2:"85"}),i.a.createElement("line",{x1:"15",x2:"85",y1:"85",y2:"15"}))}},{key:"getExpand",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("line",{x1:"15",x2:"85",y1:"50",y2:"50"}),i.a.createElement("line",{x1:"50",x2:"50",y1:"15",y2:"85"}))}},{key:"getCollapse",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("line",{x1:"20",x2:"80",y1:"50",y2:"50"}))}},{key:"getBracketWrap",value:function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("polyline",{points:"15,0 0,0 0,100 15,100"}),e,i.a.createElement("polyline",{points:"85,0 100,0 100,100 85,100"}))}},{key:"render",value:function(){var e,t="trigger-icon ";switch(this.props.iconType){case x:e=this.getRemove(),t+="remove-icon";break;case v:e=this.getExpand(),t+="expand-icon";break;case b:e=this.getCollapse(),t+="collapse-icon";break;default:console.error("incorrect type")}return this.props.inBrackets&&(e=this.getBracketWrap(e)),i.a.createElement("svg",{onClick:this.props.onClick,viewBox:"0 0 100 100",className:t},e)}}]),t}(i.a.Component),E=["Location","Implementation Dates","Number of Recipients","*ORGANIZATIONAL FEATURES","Implementing Agency","Research Agency","Funding Agency","*IMPLEMENTATION FEATURES","Type of Targeting","Unit of Recipient","Amount of Transfer","Frequency of Payment","Method of Evaluation","Additional Notes of Interest","Link to Website","Link to Related Resources"],j=["Implementing Agency","Research Agency","Funding Agency","Type of Targeting","Amount of Transfer","Additional Notes of Interest","Link to Related Resources"],O=["Link to Website"],C=function(e){return e.split("").map((function(e){return" "===e?"":e.toLowerCase()})).join("")},z=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={minimized:!0,expandedProperties:{}},a.removeCard=a.removeCard.bind(Object(d.a)(a)),a.slideDock=a.slideDock.bind(Object(d.a)(a)),a.toggleDock=a.toggleDock.bind(Object(d.a)(a)),a.maximizeDock=a.maximizeDock.bind(Object(d.a)(a)),a.toggleProperty=a.toggleProperty.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"removeCard",value:function(e){this.props.removeCard(e)}},{key:"slideDock",value:function(e){e.deltaY&&e.deltaY>0&&this.setState({minimized:!1})}},{key:"toggleDock",value:function(){var e=this;this.setState((function(t){return{minimized:!e.state.minimized}}))}},{key:"maximizeDock",value:function(){this.setState((function(e){return{minimized:!1}}))}},{key:"toggleProperty",value:function(e,t){var a=Object(f.a)({},this.state.expandedProperties);a[e]=!t,this.setState({expandedProperties:a})}},{key:"getNames",value:function(){var e=this;return this.props.cardData.map((function(t){var a=t[0],n=a.eid,o=a.name,r="name "+a.type;return i.a.createElement("td",{key:"name"+n,className:r},o||"(none)",i.a.createElement(k,{iconType:x,onClick:e.removeCard.bind(e,n)}))}))}},{key:"getRows",value:function(){var e=this;return E.map((function(t){var a=t.startsWith("*");a&&(t=t.slice(1));var n=e.getIsExpandible(t),o=!!e.state.expandedProperties[t],r=null;if(n){var s=o?b:v;r=i.a.createElement(k,{onClick:e.toggleProperty.bind(e,t,o),iconType:s})}var l="property-cell";n&&(l+=" expandible"),a&&(l+=" feature-header");var c="property-value";o&&(c+=" expanded");var u=e.props.cardData.map((function(a){var n=e.getCellContent(a,t);return i.a.createElement("td",{className:l,key:t+"-td-"+a[0].eid},i.a.createElement("div",{className:"property-name"},t,r),i.a.createElement("div",{className:c},n))}));return i.a.createElement("tr",{className:"property-row",key:t},u)}))}},{key:"getIsExpandible",value:function(e){return"Location"===e?g.a.some(this.props.cardData,(function(e){return e.length>1})):j.includes(e)}},{key:"getCellContent",value:function(e,t){if("Location"===t)return this.getLocationCellContent(e);if(t.startsWith("*"))return null;if(t.startsWith("Link to Related Resource"))return this.getLinksContent(e);var a,n=C(t),o=Object(h.a)(e),r=o[0],s=o.slice(1),l=r[n],c=O.includes(t)||g.a.every(s,(function(e){return e[n]===l}));return a=t.startsWith("Link to Website")&&l.includes(".")?i.a.createElement("a",{href:l,target:"_blank"},l):c?l:e.map((function(e){return i.a.createElement("div",{key:"cell-content-".concat(n,"-").concat(e.eid,"-").concat(e.location)},i.a.createElement("div",{title:e.location,className:"property-location-title"},e.location),e[n])})),i.a.createElement(i.a.Fragment,null,a)}},{key:"getLocationCellContent",value:function(e){var t=e.map((function(e){return i.a.createElement("div",{title:e.location,className:"location-cell-content",key:"cell-content-location-".concat(e.eid,"-").concat(e.location)},e.location)}));return i.a.createElement(i.a.Fragment,null,t)}},{key:"getLinksContent",value:function(e){var t={},a=[];return e.forEach((function(e){for(var n=0;n<8;n++){var i="".concat("Link to Related Resource"," ").concat(n),o=e[C(i)];if(o&&!t[o]){t[o]=!0;var r="".concat("Link title"," ").concat(n),s=e[C(r)];a.push({urlValue:o,titleValue:s||o})}}})),i.a.createElement("div",{key:"cell-content-links-".concat(e[0].eid)},a.map((function(e){return i.a.createElement("a",{key:e.urlValue,href:e.urlValue,target:"_blank"},e.titleValue)})))}},{key:"render",value:function(){var e="card-dock",t=String(this.props.cardData.length);return e+=" card-count-".concat(t),this.state.minimized||(e+=" maximized"),i.a.createElement("div",{onWheel:this.slideDock,onDoubleClick:this.toggleDock,onTouchStart:this.maximizeDock},i.a.createElement("table",{className:e},i.a.createElement("thead",null,i.a.createElement("tr",null,this.getNames())),i.a.createElement("tbody",null,this.getRows())))}}]),t}(i.a.PureComponent),I=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={expanded:!0},a.toggleExpand=a.toggleExpand.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"toggleExpand",value:function(){this.setState((function(e){return{expanded:!e.expanded}}))}},{key:"render",value:function(){var e="legend";this.state.expanded||(e+=" hidden");var t=this.state.expanded?b:v;return i.a.createElement("div",{className:e},i.a.createElement(k,{onClick:this.toggleExpand,inBrackets:!0,iconType:t}),i.a.createElement("div",{className:"content"},i.a.createElement("div",null,i.a.createElement("i",{className:"past"}),"Past Experiments"),i.a.createElement("div",null,i.a.createElement("i",{className:"ongoing"}),"Ongoing Experiments"),i.a.createElement("div",null,i.a.createElement("i",{className:"proposed"}),"Proposed Experiments")))}}]),t}(i.a.Component),S=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={left:0,top:0,adjusted:!1},a.ref=i.a.createRef(),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.expId;this.props.expId!==t&&t&&this.setState({adjusted:!1,left:e.x,top:e.y})}},{key:"componentDidUpdate",value:function(){!this.state.adjusted&&this.props.expId&&this.adjustPosition()}},{key:"adjustPosition",value:function(){var e=this.ref.current.getBoundingClientRect(),t=e.width,a=e.height,n=document.getElementById("root").getBoundingClientRect(),i=n.width,o=n.height,r=this.state,s=r.left,l=r.top;(l-=a+7)<0&&(l+=a+14)+a>o&&(l=1),(s+=7)+t>i&&(s-=t+14)<0&&(s=i-(t+2)),this.setState({left:s,top:l,adjusted:!0})}},{key:"getLocations",value:function(){var e=this.props,t=e.location,a=e.otherLocations,n="hovered-location",o=null;return a.length&&(n+=" emphasized",o=a.map((function(e){return i.a.createElement("p",{key:e},e)}))),i.a.createElement(i.a.Fragment,null,i.a.createElement("p",{className:n},t),o)}},{key:"render",value:function(){var e=this.props,t=e.expId,a=e.name,n=e.type;if(!t)return null;var o={};o=this.state.adjusted?{left:this.state.left+"px",top:this.state.top+"px"}:{visibility:"hidden",left:"0px",top:"0px"};var r="tooltip "+n;return i.a.createElement("div",{className:r,style:o,ref:this.ref},i.a.createElement("div",{className:"name"},a||"(none)"),i.a.createElement("div",{className:"detail"},i.a.createElement("p",{className:"location-title"},"Location:"),this.getLocations()),i.a.createElement("p",{className:"click-hint"},"click point for more info"))}}]),t}(i.a.Component),N=a(9),L=a.n(N),w=a(13);a(24);L.a.accessToken="pk.eyJ1IjoiZXZpY3Rpb24tbGFiIiwiYSI6ImNqY20zamVpcTBwb3gzM28yb292YzM3dXoifQ.uKgAjsMd4qkJNqEtr3XyPQ";function F(){var e=this;String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){var a=t>0?0|t:0;return this.substring(a,a+e.length)===e}});var t={type:"FeatureCollection",features:[]},a=new XMLHttpRequest;a.addEventListener("load",(function(){!function(a,n){var i=JSON.parse(n.responseText).feed.entry,o=Object.keys(i[0]).filter((function(e){return e.startsWith("gsx$")&!e.endsWith("_db1zf")})).map((function(e){return e.substr(4)})),r=i.map((function(e,t){var a={};return o.forEach((function(t){a[t]=""===e["gsx$"+t].$t?null:e["gsx$"+t].$t,-1!==["latitude","longitude","eid","uid"].indexOf(t)&&(a[t]=+a[t]),null===a[t]&&(a[t]="")})),{type:"Feature",id:a.eid,geometry:{type:"Point",coordinates:[a.longitude,a.latitude]},properties:a}}));t={type:"FeatureCollection",features:r},e.map.getSource("experiments").setData(t)}(0,a)})),a.open("GET","https://spreadsheets.google.com/feeds/list/1gyAdUp3tekxAtz8fibILM-zHyX5CXh5OuY0Xbjxhijw/1/public/full?alt=json"),a.send()}var T=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={lat:40.66995747013945,lng:-103.59179687498357,zoom:3,hovered:{},selectedIds:[],isTouchScreen:!1},a.map=null,a.getCardDock=a.getCardDock.bind(Object(d.a)(a)),a.getTooltip=a.getTooltip.bind(Object(d.a)(a)),a.removeCard=a.removeCard.bind(Object(d.a)(a)),a.getFeaturesByExperimentId=a.getFeaturesByExperimentId.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.map=new L.a.Map({container:this.mapContainer,style:w,center:[this.state.lng,this.state.lat],zoom:this.state.zoom}),this.map.on("move",(function(){e.featuresOnUnhover(),e.setState({lng:e.map.getCenter().lng.toFixed(4),lat:e.map.getCenter().lat.toFixed(4),zoom:e.map.getZoom().toFixed(2)})})),this.map.on("click","experimentSites",this.featuresOnClick.bind(this)),this.map.on("mouseenter","experimentSites",this.featuresOnHover.bind(this)),this.map.on("mouseleave","experimentSites",this.featuresOnUnhover.bind(this)),this.map.on("touchstart","experimentSites",this.touchstart.bind(this)),F.call(this)}},{key:"touchstart",value:function(e){this.setState({isTouchScreen:!0})}},{key:"getFeaturesByExperimentId",value:function(e){return this.map.getSource("experiments")._data.features.filter((function(t){return t.id===e})).map((function(e){return e.properties}))}},{key:"featuresOnClick",value:function(e){var t=e.features[0].id,a=Object(s.a)(this.state.selectedIds),n=a.indexOf(t),i=n>-1;if(i)a.splice(n,1);else{if(a.length>=3)return void console.log("OH SHET!");a.push(t)}this.setState({selectedIds:a}),this.map.setFeatureState({source:"experiments",id:t},{selected:!i})}},{key:"featuresOnHover",value:function(e){if(!this.state.isTouchScreen){this.map.getCanvas().style.cursor="pointer";var t=e.features[0],a=t.id,n=t.properties,i=n.name,o=n.location,r=n.type,s=e.point,l=s.x,c=s.y;this.setState({hovered:{expId:a,name:i,location:o,type:r,x:l,y:c}}),this.map.setFeatureState({source:"experiments",id:a},{hover:!0})}}},{key:"featuresOnUnhover",value:function(){!this.state.isTouchScreen&&this.state.hovered.expId&&(this.map.getCanvas().style.cursor="",this.map.setFeatureState({source:"experiments",id:this.state.hovered.expId},{hover:!1}),this.setState({hovered:{}}))}},{key:"removeCard",value:function(e){var t=Object(s.a)(this.state.selectedIds),a=t.indexOf(e);t.splice(a,1),this.setState({selectedIds:t}),this.map.setFeatureState({source:"experiments",id:e},{selected:!1})}},{key:"getTooltip",value:function(){var e=this.state.hovered,t=e.expId,a=e.name,n=e.location,o=e.type,r=e.x,s=e.y,l=[];t&&(l=this.getFeaturesByExperimentId(t).map((function(e){return e.location})).filter((function(e){return e!==n})));return i.a.createElement(S,{expId:t,name:a,location:n,otherLocations:l,type:o,x:r,y:s})}},{key:"getCardDock",value:function(){if(!this.map||!this.state.selectedIds.length)return null;var e=this.state.selectedIds.map(this.getFeaturesByExperimentId);return i.a.createElement(z,{removeCard:this.removeCard,cardData:e})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"app"},this.getCardDock(),this.getTooltip(),i.a.createElement("div",{ref:function(t){return e.mapContainer=t},className:"map-container"}),i.a.createElement(I,null))}}]),t}(i.a.Component);r.a.render(i.a.createElement(T,null),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.01f619cf.chunk.js.map